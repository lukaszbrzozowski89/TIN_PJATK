<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Flight Services System</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&amp;subset=latin-ext" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css"
          integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
    <link rel="stylesheet" href="main.css">

</head>
<body>
<section class="piece">
    <div class="container-fluid">
        <header>
            <h1>Flight System Services</h1>
            <p>Przyk≈Çady CRUD TIN</p>
        </header>
        <div class="row">
            <div class="col-md-12">
                <button id="refreshButton" type="submit" class="pure-button pure-button-primary"
                        onclick="window.location.reload()">Refresh
                </button>
                <br>
                <br>
                <hr class="stripped-border">
            </div>
            <h2>Get Methods</h2>
            <div class="col-md-3">
                <form class="pure-form" id="welcomeForm">
                    <fieldset>
                        <input hidden="hidden">
                        <br>
                        <br>
                        <button id="btn" type="submit" class="pure-button pure-button-primary"
                                formaction="/api/airports">GET All Airports
                        </button>
                        <button id="btn2" type="submit" class="pure-button pure-button-primary"
                                formaction="/api/flights">GET All Flights
                        </button>
                        <br>
                        <br>
                        <hr class="stripped-border">
                    </fieldset>
                </form>
            </div>
            <div class="col-md-3">
                <form class="pure-form">
                    <fieldset>
                        <input id="inputId" type="number" placeholder="Enter id:"/>
                        <br>
                        <br>
                        <button id="btnById" type="submit" class="pure-button pure-button-primary">
                            GET Airport by ID
                        </button>
                        <button id="btn2ById" type="submit" class="pure-button pure-button-primary">
                            Get Flight by ID
                        </button>
                        <br>
                        <br>
                        <hr class="stripped-border">
                    </fieldset>
                </form>
            </div>
            <div class="col-md-3">
                <form class="pure-form">
                    <fieldset>
                        <input id="inputNumber" type="text" placeholder="Enter number:"/>
                        <br>
                        <br>
                        <button id="btn2ByFlightNumber" type="submit" class="pure-button pure-button-primary">
                            Get Flight by Number
                        </button>
                        <br>
                        <br>
                        <hr class="stripped-border">
                    </fieldset>
                </form>
            </div>

            <div class="col-md-3">
                <form class="pure-form">
                    <fieldset>
                        <input id="inputCode" type="text" placeholder="Enter code:"/>
                        <br>
                        <br>
                        <button id="btn2ByCode" type="submit" class="pure-button pure-button-primary">
                            GET Airport by Code
                        </button>
                        <br>
                        <br>
                        <hr class="stripped-border">
                    </fieldset>
                </form>
            </div>

            <h2>Add Method</h2>
            <div class="col-sm-12">
                <form class="pure-form">
                    <fieldset>
                        <input id="airportNameInput" type="text" placeholder="Enter user name:"/>
                        <br>
                        <br>
                        <input id="airportCodeInput" type="text" placeholder="Enter user code:"/>
                        <br><br>
                        <button id="addAirportToDB" type="submit" class="pure-button pure-button-primary">
                            Add Airport
                        </button>
                        <br>
                        <br>
                        <hr class="stripped-border">
                    </fieldset>
                </form>
            </div>

            <h2>Update Method</h2>
            <div class="col-sm-12">
                <form class="pure-form">
                    <fieldset>
                        <input id="airportIdInputUpdate" type="text" placeholder="Enter user id:"/>
                        <br>
                        <br>
                        <input id="airportNameInputUpdate" type="text" placeholder="Enter user name:"/>
                        <br>
                        <br>
                        <input id="airportCodeInputUpdate" type="text" placeholder="Enter user code:"/>
                        <br><br>
                        <button id="updateAirport" type="submit" class="pure-button pure-button-primary">
                            Update Airport Data
                        </button>
                        <br>
                        <br>
                        <hr class="stripped-border">
                    </fieldset>
                </form>
            </div>

            <h2>Delete Method</h2>
            <div class="col-sm-12">
                <form class="pure-form">
                    <fieldset>
                        <input id="deleteIdInput" type="text" placeholder="Enter user id to delete:"/>
                        <br>
                        <br>
                        <button id="deleteAirportButton" type="submit" class="pure-button pure-button-primary">
                            Delete Airport
                        </button>
                        <br>
                        <br>
                        <hr class="stripped-border">
                    </fieldset>
                </form>
            </div>
            <h3>Tables</h3>
            <div class="col-sm-12">
                <table align="center"
                       id="table" class="pure-table pure-table-bordered" aria-rowspan="25px" frame=void rules=rows>
                </table>
                <br>
                <br>
                <table align="center" id="jsonTable" class="pure-table pure-table-bordered" aria-rowspan="25px"
                       frame=void rules=rows></table>
            </div>
            <hr class="stripped-border">
            <h3>Json responses</h3>
            <div class="col-sm-12">
                <table id="demoA" class="pure-table pure-table-bordered" style="border: black" aria-rowspan="25px"
                       frame=void
                       rules=rows><br></table>
                <pre id="jsonPre" style="font-size: small"></pre>
                <hr class="stripped-border">
            </div>
            <div class="col-sm-12">
                <table id="demoB" class="pure-table pure-table-bordered" style="border: black" aria-rowspan="25px"
                       frame=void
                       rules=rows></table>
                <pre id="jsonPreCode" style="font-size: small" ></pre>
                <hr class="stripped-border">
            </div>
        </div>
    </div>
</section>


<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"
        integrity="sha384-q2kxQ16AaE6UbzuKqyBE9/u/KzioAlnx2maXQHiDX9d4/zp8Ok3f+M7DPm+Ib6IU"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.min.js"
        integrity="sha384-pQQkAEnwaBkjpqZ8RU1fF1AKtTcHJwFl3pblpTlHXybJjHpMYo79HY3hIi4NKxyj"
        crossorigin="anonymous"></script>
<script src="js/bootstrap.min.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js">
</script>
<script>
    let inputId = document.getElementById("inputId");
    let inputNumber = document.getElementById("inputNumber");
    let inputCode = document.getElementById("inputCode");

    let airportNameInput = document.getElementById("airportNameInput");
    let airportCodeInput = document.getElementById("airportCodeInput");
    let airportIdInputUpdate = document.getElementById("airportIdInputUpdate");
    let airportNameInputUpdate = document.getElementById("airportNameInputUpdate");
    let airportCodeInputUpdate = document.getElementById("airportCodeInputUpdate");
    let deleteIdInput = document.getElementById("deleteIdInput");


    //get all airports
    document.getElementById('btn').addEventListener('click', (event) => {
        event.preventDefault();
        fetch('api/airports')
            .then(response => response.json())
            .then((json) => {
                showJsonData(json, "jsonPre");
                constructTable(json, '#table');
            });
    });
    //get all flights
    document.getElementById('btn2').addEventListener('click', (event) => {
        event.preventDefault();
        fetch('api/flights/')
            .then(response => response.json())
            .then((json) => {
                showJsonData(json, "jsonPre");
                constructTable(json, '#table');
            });
    });
    //get user by id
    document.getElementById('btnById').addEventListener('click', (event) => {
        event.preventDefault();
        let obj = {id: inputId.value};
        let url = '/api/airports/' + new URLSearchParams(obj);
        fetch(url)
            .then(response => response.json())
            .then((json) => {
                showJsonData(json, "jsonPre");
                constructTableID(json);
            });
    });
    //get reservation by id
    document.getElementById('btn2ById').addEventListener('click', (event) => {
        event.preventDefault();
        let obj = {id: inputId.value};
        let url = '/api/flights/' + new URLSearchParams(obj);
        fetch(url)
            .then(response => response.json())
            .then((json) => {
                showJsonData(json, "jsonPre");
                constructTableID(json);
            });
    });
    //get reservation by flightName
    document.getElementById('btn2ByFlightNumber').addEventListener('click', (event) => {
        event.preventDefault();
        let obj = {flightNumber: inputNumber.value};
        let url = '/api/flights/' + new URLSearchParams(obj);
        fetch(url)
            .then(response => response.json())
            .then((json) => {
                showJsonData(json, "jsonPreCode");
                constructTableID(json);
            });
    });
    //get user by code
    document.getElementById('btn2ByCode').addEventListener('click', (event) => {
        event.preventDefault();
        let obj = {code: inputCode.value};
        let url = '/api/airports/' + new URLSearchParams(obj);
        fetch(url)
            .then(response => response.json())
            .then((json) => {
                showJsonData(json, "jsonPreCode");
                constructTableID(json);
            });
    });

    //add user
    document.getElementById('addAirportToDB').addEventListener('click', (event) => {
        event.preventDefault();
        let url = '/api/airports/';
        fetch(url,
            {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                method: "POST",
                body: JSON.stringify({airportName: airportNameInput.value, code: airportCodeInput.value})
            })
            .then(function (res) {
                console.log(res)
            })
            .catch(function (res) {
                console.log(res)
            });

    });
    //delete user
    document.getElementById('deleteAirportButton').addEventListener('click', (event) => {
        event.preventDefault();
        let obj = {id: deleteIdInput.value};
        let url = '/api/airports/' + new URLSearchParams(obj);
        fetch(url,
            {
                method: "DELETE",
            })
            .then(function (res) {
                console.log(res)
            })
            .catch(function (res) {
                console.log(res)
            });

    });

    //update user
    document.getElementById('updateAirport').addEventListener('click', (event) => {
        event.preventDefault();
        let obj = {
            id: airportIdInputUpdate.value
        };
        let url = '/api/airports/' + new URLSearchParams(obj);
        fetch(url,
            {
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                method: "POST",
                body: JSON.stringify({
                    id: airportIdInputUpdate.value,
                    airportName: airportNameInputUpdate.value,
                    code: airportCodeInputUpdate.value
                })
            })
            .then(function (res) {
                console.log(res)
            })
            .catch(function (res) {
                console.log(res)
            });

    });


    function showJsonData(json, selector) {
        document.getElementById(selector).innerHTML = JSON.stringify(json, undefined, 4);
    }

    function showJsonDataByCode(json) {
        document.getElementById("jsonPreCode").innerHTML = JSON.stringify(json, undefined, 4);
    }

    function constructTableID(list) {
        var table = document.createElement("table"), row, cellA, cellB;
        document.getElementById("jsonTable").appendChild(table);
        for (let key in list) {

            // (C2) ROWS & CELLS

            row = document.createElement("td");

            cellA = document.createElement("tr");
            cellB = document.createElement("tr");

            row.style.columnWidth = '100px';
            row.style.textAlign = 'center';

            // (C3) KEY & VALUE
            cellA.innerHTML = key;
            cellB.innerHTML = list[key];

            // (C4) ATTACH ROW & CELLS
            table.appendChild(row);
            row.appendChild(cellA);
            row.appendChild(cellB);
        }
    }

    function constructTable(list, selector) {

        // Getting the all column names
        var cols = Headers(list, selector);

        // Traversing the JSON data
        for (var i = 0; i < list.length; i++) {
            var row = $('<tr/>');
            for (var colIndex = 0; colIndex < cols.length; colIndex++) {
                var val = list[i][cols[colIndex]];

                // If there is any key, which is matching
                // with the column name
                if (val == null) val = "";
                row.append($('<td/>').html(val));
            }

            // Adding each row to the table
            $(selector).append(row);
        }
    }

    function Headers(list, selector) {
        var columns = [];
        var header = $('<tr/>');

        for (var i = 0; i < list.length; i++) {
            var row = list[i];

            for (var k in row) {
                if ($.inArray(k, columns) === -1) {
                    columns.push(k);

                    // Creating the header
                    header.append($('<th/>').html(k));
                }
            }
        }
        // Appending the header to the table
        $(selector).append(header);
        return columns;
    }
</script>

</body>
</html>
